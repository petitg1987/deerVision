limit_req_zone $binary_remote_addr zone=req_zone:500m rate={{ max_requests_by_second }}r/s;
server {
   listen 443;
   listen [::]:443;
   server_name _;
   ssl on;
   ssl_certificate /home/ubuntu/data/letsencrypt/config/live/backend.deervision.studio/fullchain.pem;
   ssl_certificate_key /home/ubuntu/data/letsencrypt/config/live/backend.deervision.studio/privkey.pem;
   client_max_body_size {{ max_requests_body_size_in_kb }}K;
   location / {
      limit_req zone=req_zone burst={{ max_requests_burst }} nodelay;
      proxy_set_header X-Forwarded-Host $host;
      proxy_set_header X-Forwarded-Port 443;
      proxy_set_header X-Forwarded-Proto https;
      proxy_set_header X-Forwarded-For $remote_addr;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_pass http://127.0.0.1:8080;
   }
}
